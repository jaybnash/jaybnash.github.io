<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title | default: "Citation" }}</title>
  <link rel="stylesheet" type="text/css" href="{{ "/stylesheet.css" | relative_url }}">
  <style>
    .citation-container {
      max-width: 800px;
      margin: 40px auto;
      padding: 0 16px;
    }
    pre {
      background: #f5f5f5;
      padding: 16px;
      overflow-x: auto;
      border-radius: 6px;
      margin: 20px 0;
      font-family: monospace;
    }
    .citation-buttons {
      margin-top: 12px;
    }
    .citation-buttons .button-link {
      background: transparent;
      border: 1px solid #000;
      color: #000 !important;
      min-width: 100px;
      margin: 0 8px;
    }
    .citation-buttons .button-link:hover {
      background: #000;
      color: #fff !important;
    }
  </style>
</head>
<body>
  <div class="citation-container">
    <h2 id="citation-title" style="text-align:center;">Citation</h2>

    <pre id="bib-code"></pre>

    <div class="citation-buttons center-text">
      <button id="copy-btn" class="button-link">Copy</button>
      <a id="download-btn" class="button-link" href="#" download>Download .bib File</a>
    </div>
  </div>

  <script>
    (function() {
      // Get the filename from the path
      const path = window.location.pathname;
      let bibName = path.split('/').pop();
      
      // If no file specified, try to get it from the query params (backward compatibility)
      if (!bibName || bibName === 'cite.html') {
        const params = new URLSearchParams(window.location.search);
        bibName = params.get('bib');
      }

      if(!bibName){
        document.getElementById('bib-code').textContent = 'No bib file specified.';
        return;
      }
      
      // Ensure .bib extension
      if(!bibName.endsWith('.bib')) bibName += '.bib';
      
      const bibBase = '{{ "/assets/citations/" | relative_url }}';
      const bibPath = bibBase + bibName;
      document.getElementById('download-btn').href = bibPath;

      fetch(bibPath)
        .then(resp => {
          if (!resp.ok) throw new Error('Failed to load citation file');
          return resp.text();
        })
        .then(text => {
          const codeElem = document.getElementById('bib-code');
          codeElem.textContent = text.trim();
          
          // Extract title from BibTeX
          const titleMatch = text.match(/title\s*=\s*{([^}]+)}/);
          const paperTitle = titleMatch ? titleMatch[1] : 'Unknown Paper';
          
          // Update page title and heading with the extracted title
          const titleText = `Citation for "${paperTitle}"`;
          document.title = titleText;
          document.getElementById('citation-title').innerText = titleText;
        })
        .catch(err => {
          console.error('Failed to load bib file:', err);
          document.getElementById('bib-code').textContent = 'Failed to load citation.';
        });

      const copyBtn = document.getElementById('copy-btn');
      copyBtn.addEventListener('click', function() {
        const text = document.getElementById('bib-code').textContent;
        navigator.clipboard.writeText(text).then(() => {
          copyBtn.textContent = 'Copied!';
          setTimeout(() => copyBtn.textContent = 'Copy', 3000);
        }).catch(err => alert('Copy failed: ' + err));
      });
    })();
  </script>
</body>
</html> 